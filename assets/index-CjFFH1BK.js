var Y=Object.defineProperty;var J=(i,e,t)=>e in i?Y(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var P=(i,e,t)=>(J(i,typeof e!="symbol"?e+"":e,t),t),K=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var a=(i,e,t)=>(K(i,e,"read from private field"),t?t.call(i):e.get(i)),j=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},w=(i,e,t,r)=>(K(i,e,"write to private field"),r?r.call(i,t):e.set(i,t),t);var S=(i,e,t)=>(K(i,e,"access private method"),t);import{au as X,av as _,aw as W,ax as ee,ay as $,az as V,r as l,H as te,L as A,aA as se,j as s,M as z,d as D,t as v,C as ie,I as G,aB as N,T as B,c as re,B as ae,h as F,e as oe}from"./index-BScicdtP.js";import{n as ne,s as le,u as ce}from"./useQuery-BKTTnkpa.js";import{T as Q,C as ue}from"./container-B3BeFI1r.js";import{S as de,D as he,a as pe}from"./data-table-CpwbfCJc.js";import{C as me}from"./index-w2ETDo18.js";import"./TableRow-B5gzecQl.js";import"./TableCell-Bmz07LmC.js";var f,g,c,b,M,E,O,q,U,ye=(U=class extends X{constructor(e,t){super();j(this,M);j(this,O);j(this,f,void 0);j(this,g,void 0);j(this,c,void 0);j(this,b,void 0);w(this,f,e),this.setOptions(t),this.bindMethods(),S(this,M,E).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var r;const t=this.options;this.options=a(this,f).defaultMutationOptions(e),_(this.options,t)||a(this,f).getMutationCache().notify({type:"observerOptionsUpdated",mutation:a(this,c),observer:this}),t!=null&&t.mutationKey&&this.options.mutationKey&&W(t.mutationKey)!==W(this.options.mutationKey)?this.reset():((r=a(this,c))==null?void 0:r.state.status)==="pending"&&a(this,c).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=a(this,c))==null||e.removeObserver(this)}onMutationUpdate(e){S(this,M,E).call(this),S(this,O,q).call(this,e)}getCurrentResult(){return a(this,g)}reset(){var e;(e=a(this,c))==null||e.removeObserver(this),w(this,c,void 0),S(this,M,E).call(this),S(this,O,q).call(this)}mutate(e,t){var r;return w(this,b,t),(r=a(this,c))==null||r.removeObserver(this),w(this,c,a(this,f).getMutationCache().build(a(this,f),this.options)),a(this,c).addObserver(this),a(this,c).execute(e)}},f=new WeakMap,g=new WeakMap,c=new WeakMap,b=new WeakMap,M=new WeakSet,E=function(){var t;const e=((t=a(this,c))==null?void 0:t.state)??ee();w(this,g,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},O=new WeakSet,q=function(e){$.batch(()=>{var t,r,n,u,o,d,p,x;if(a(this,b)&&this.hasListeners()){const h=a(this,g).variables,m=a(this,g).context;(e==null?void 0:e.type)==="success"?((r=(t=a(this,b)).onSuccess)==null||r.call(t,e.data,h,m),(u=(n=a(this,b)).onSettled)==null||u.call(n,e.data,null,h,m)):(e==null?void 0:e.type)==="error"&&((d=(o=a(this,b)).onError)==null||d.call(o,e.error,h,m),(x=(p=a(this,b)).onSettled)==null||x.call(p,void 0,e.error,h,m))}this.listeners.forEach(h=>{h(a(this,g))})})},U);function Z(i,e){const t=V(e),[r]=l.useState(()=>new ye(t,i));l.useEffect(()=>{r.setOptions(i)},[r,i]);const n=l.useSyncExternalStore(l.useCallback(o=>r.subscribe($.batchCalls(o)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),u=l.useCallback((o,d)=>{r.mutate(o,d).catch(ne)},[r]);if(n.error&&le(r.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:u,mutateAsync:n.mutate}}const k=class k extends te{static getInstance(){return k.instance||new k}constructor(){if(super(),k.instance)throw new Error("Service is already initialized. Use `OrgService.getInstance()` instead.");k.instance=this}list(){return this.get({url:"/api-keys"})}create(e,t){return this.post({url:"/api-keys",params:{name:e,description:t}})}remove(e){return this.delete({url:`/api-keys/${e}`})}};P(k,"instance");let I=k;const be=i=>l.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...i},l.createElement("path",{d:"M5.58024 5.85059H5.5C4.39543 5.85059 3.5 6.74602 3.5 7.85059V16.2532C3.5 17.3577 4.39543 18.2532 5.5 18.2532H11.8575C12.9621 18.2532 13.8575 17.3577 13.8575 16.2532V16.2281",stroke:"white",strokeWidth:1.5,strokeLinecap:"square"}),l.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.25 2C7.14543 2 6.25 2.89543 6.25 4V14C6.25 15.1046 7.14543 16 8.25 16H15.25C16.3546 16 17.25 15.1046 17.25 14V7.1058C17.25 6.55924 17.0263 6.03648 16.631 5.65909L14.8929 4L13.3773 2.55329C13.0052 2.19815 12.5106 2 11.9963 2H8.25ZM12.1036 3.85355L15.3964 7.14645C15.7114 7.46143 15.4883 8 15.0429 8H11.75C11.4739 8 11.25 7.77614 11.25 7.5V4.20711C11.25 3.76165 11.7886 3.53857 12.1036 3.85355Z",fill:"white"})),xe=({isOpen:i,setIsOpen:e})=>{const[t,r]=l.useState(""),[n,u]=l.useState(""),[o,d]=l.useState(void 0),[p,x]=l.useState(!1),h=A(I),m=V(),H=Z({mutationFn:()=>h.create(t,n),onSuccess:y=>{d(y.data.apikey),x(!1),m.invalidateQueries({queryKey:["apikeys"]})},onError:y=>{console.error(y)}}),R=()=>{o===void 0?(x(!0),H.mutate()):(x(!1),e(!1))},T=A(se),C=y=>{navigator.clipboard.writeText(y),T.show("Value has been copied to your clipboard","success","Copeid!")},L={submitButtonLabel:"Create Key",submitButtonColor:"primary"};return o!=null&&o.secret&&(L.cancelButtonVisible=!1,L.submitButtonLabel="Done"),s.jsx(z,{id:"create-api-key-modal",title:"Create API Key",open:i,onClose:()=>e(!1),onSubmit:R,loading:p,submitButtonDisabled:p||!t,cancelButtonDisabled:p,...L,children:o!=null&&o.secret?s.jsxs(D,{sx:{"> .MuiAlert-root:not(:last-child)":{mb:v.spacing(2)}},children:[s.jsxs(ie,{sx:{position:"relative"},children:[s.jsx(me,{defaultValue:o==null?void 0:o.secret,lineNumbers:!1,readOnly:!0,mode:"shell",sx:{".CodeMirror":{pr:v.spacing(6),backgroundColor:`${v.palette.background.paper} !important`,borderRadius:"6px"}}}),s.jsx(G,{id:"copy-api-key-button",onClick:()=>C(o==null?void 0:o.secret),sx:{position:"absolute",top:0,right:0},children:s.jsx(be,{width:20,height:20})})]}),s.jsx(N,{severity:"warning",children:"Copy the API key and store it securely.The API key will not be available to view after you leave this page."}),s.jsxs(N,{severity:"info",children:[s.jsx(B,{variant:"body2",sx:{fontWeight:500},children:"Safeguard your API key."}),s.jsxs("ul",{children:[s.jsx("li",{children:"Store it in a secure location with strong encryption."}),s.jsx("li",{children:"Revoke the key if security has been compromised."}),s.jsx("li",{children:"DO NOT embed it in code."})]})]})]}):s.jsxs(s.Fragment,{children:[s.jsx(Q,{id:"api-key-name",disabled:!1,name:"api-key-name",helperText:!t&&"Name is required",placeholder:"Name",value:t,onChange:y=>r(y.target.value),fullWidth:!0,variant:"standard",sx:{mb:v.spacing(2)},error:!t},"api-key-name"),s.jsx(Q,{id:"api-key-description",disabled:!1,name:"api-key-description",helperText:!n&&"Description is required",placeholder:"Description",value:n,onChange:y=>u(y.target.value),fullWidth:!0,variant:"standard",sx:{mb:v.spacing(2)},error:!n},"api-key-description"),s.jsx(N,{severity:"info",children:"Key value will only ever be shown once, immediately after creation. Copy it to your destination right away."})]})})},ve=({isOpen:i,deletingAPIKey:e,isLoading:t=!1,onClose:r,onExited:n,onSubmit:u})=>s.jsx(z,{id:"delete-api-key-modal",title:`Delete ${e==null?void 0:e.name} API Key`,open:i,onClose:r,onSubmit:u,onExited:n,loading:t,submitButtonLabel:"Delete Key",submitButtonColor:"error",submitButtonDisabled:t,children:s.jsxs(B,{variant:"body2",color:"text.secondary",sx:{strong:{fontWeight:500}},children:["You are going to permanatly delete “",s.jsx("strong",{children:e==null?void 0:e.name}),"” API Key. Are you sure you want to do this?"]})}),Oe=()=>{const{formatMessage:i}=re(),e=A(I),t=V(),{isPending:r,error:n,data:u}=ce({queryKey:["apikeys"],queryFn:()=>e.list()}),o=Z({mutationFn:()=>e.remove(d==null?void 0:d.id),onSuccess:()=>{p(void 0),t.invalidateQueries({queryKey:["apikeys"]})}}),[d,p]=l.useState(void 0),[x,h]=l.useState(!1),[m,H]=l.useState(void 0),R=()=>{console.log("Create credential",m)},T=()=>{o.mutate()};return s.jsxs(ue,{children:[s.jsxs(D,{container:!0,direction:"column",flexWrap:"nowrap",id:"buckets-list",children:[s.jsxs(D,{container:!0,alignItems:"center",justifyContent:"space-between",children:[s.jsx(B,{variant:"h2",id:"buckets-list-header",children:i({id:"apikeys.title",defaultMessage:"API keys"},{})}),s.jsxs(ae,{variant:"contained",sx:{ml:v.spacing(2)},onClick:()=>h(!0),children:[s.jsx(de,{width:20,height:20}),s.jsx(B,{variant:"button",sx:{ml:v.spacing(1)},children:i({id:"apikeys.create_cta",defaultMessage:"Create"})})]})]}),s.jsx("br",{}),s.jsx(he,{id:"credentials-table",columns:{id:{title:"ID",width:200},name:{title:"Name"},description:{title:"Description"},created_at:{title:"Created",width:150},expires_at:{title:"Expires",width:150}},rows:r?[]:(u==null?void 0:u.data.apikeys)??[],renderNoRows:()=>"No API keys created yet.",renderCell:{created_at:C=>F(C).calendar(),expires_at:C=>F(C).calendar()},renderActions:C=>s.jsx(D,{container:!0,justifyContent:"space-between",children:s.jsx(oe,{title:"Remove",placement:"right-start",children:s.jsx(G,{className:"remove-bucket-button",sx:{p:v.spacing(.25)},onClick:()=>p(C),children:s.jsx(pe,{})})})})})]}),s.jsx(ve,{isOpen:d!==void 0,deletingAPIKey:d,onClose:()=>p(void 0),onSubmit:T}),s.jsx(xe,{isOpen:x,setIsOpen:h,onClose:()=>h(!1),onSubmit:R,apiKey:m})]})};export{ve as DeleteModal,Oe as default};
